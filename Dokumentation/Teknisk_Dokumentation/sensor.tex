\section{Sensorenhet}

Sensorenheten √§r den enhet som behandlar all sensordata. Den samlar in data fr√•n 
avst√•ndssensorerna och linjesensorerna som den sedan antingen omvandlar till 
cm v√§rden i avst√•ndsensorns fall, eller tr√∂sklar och ger diskreta varierande storheter 
som i linjesensorns fall. Linje sensorn kommunicerar sedan med kommunikationsenheten
som f√∂rmedlar v√§rdena till styrenheten och till PCn.

\subsection{H√•rdvara}

\begin{figure}[H]
  \centering
 \includegraphics[angle=0,scale=0.5]{bilder/PIN_sensor.jpg}
  \caption{Sensorsenhetens pin-anslutningar}
  \label{fig:PINsensor}
\end{figure}

\subsubsection{Linjef√∂ljarsensor}
F√∂r att maximera robotens framf√∂rh√•llning √§r sensorerna monterade framf√∂r roboten 
s√• l√•ngt fram som m√∂jligt ca 3 mm ovanf√∂r marken. Linjesensorn best√•r av 11st lysdioder 
med 11st ljusk√§nsliga transistorer, en multiplex och en demultiplex.

\begin{figure}[H]
  \centering
 \includegraphics[angle=0,scale=0.5]{bilder/Uppkoppling_linjesensorer.pdf}
  \caption{Uppkoppling linjesensorer}
  \label{fig:Uppkoppling_linjesensorer}
\end{figure}

CH1 EN ‚Äì CH11 EN √§r ing√•ngar som leder signalen (logiskt ) vidare till lysdioderna. 
CH1  OUT - CH11 OUT Leder svarssignalen fr√•n transistorerna vidare mot styrenhetens 
AVR. Multiplexen och demultiplexen styrs med signalerna A ‚Äì D fr√•n AVRen. Inhibit 
signalen √§r jordad d√• datav√§ljning alltid ska vara till√•ten.



\subsubsection{Uppt√§ckning av riktningsmarkeringar}
\label{sec:riktmark}
D√• roboten √§r i en labyrint kommer linjef√∂ljarsensorn huvudsakligen anv√§ndas 
f√∂r att hitta riktningsmarkeringar. Dessa markeringar anv√§nds f√∂r att visa i 
vilken riktning roboten ska f√§rdas i n√§stkommande korsning.  I enlighet med 
banspecifikationen, se *REF BANSPEC*, √§r funktionen anpassad f√∂r att uppfatta 
f√∂ljande signaler:

H√∂gersv√§ng visas med en tunn tejpmarkering f√∂ljd av en tre g√•nger s√• tjock.
V√§nstersv√§ng visas genom en tjock tejpmarkering f√∂ljd av en tre g√•nger s√• tunn.
Fram√•t visas genom tv√• tunna tejpmarkeringar.

Vid varje uppdatering av samtliga linjef√∂ljarsensorer g√∂rs en kontroll om de 
tre mittersta sensorerna ligger √∂ver tejp. √Ñr s√• fallet s√• b√∂rjar antalet 
g√•nger linjesensorerna uppdateras att r√§knas. N√§r de tre mittersta sensorerna 
inte l√§ngre ligger √∂ver tejp sparas antalet iterationer som sensorerna 
tillbringat √∂ver tejpen. Proceduren upprepas d√§refter och antalet iterationer 
j√§mf√∂rs f√∂r att se vilken tejpbit som var bredast, den f√∂rsta eller den andra
. Resultatet sparas d√§refter och efterfr√•gat kommando utf√∂rs i n√§stkommande 
korsning, se \ref{sec:upptackkorsning}.


\subsubsection{Avst√•ndssensorer}

\subsubsection{Uppt√§ckning av korsningar och 90\degree sv√§ngar}
\label{sec:upptackkorsning}
Enligt specifikationen av den bana som roboten ska kunna f√∂lja, framg√•r det 
att det f√∂re alla korsningar ska finnas tejpmarkeringar som visar i vilken 
riktning roboten ska sv√§nga, se \ref{sec:riktmark}. Roboten kommer att 
uppt√§cka korsningar om tv√• av riktningarna h√∂ger, v√§nster och fram√•t visar 
mer √§n 80 cm.

Roboten kommer att uppt√§cka 90\degree sv√§ngar om det √§r l√§ngre √§n 80 cm √•t 
h√∂ger eller v√§nster(inte b√•da), samt mindre √§n 35cm fram√•t.

Uppt√§cker roboten en korsning kommer det kommando som beskrivits av tidigare 
tejpmarkeringar att skickas till styrenheten. Datat som skickas √§r skrivet 
f√∂r att uppfattas som ett s√• kallat specialkommando, det vill s√§ga 
styrenheten har en procedur som utf√∂rs utan att ta h√§nsyn till den reglerdata 
som skickas fr√•n sensorenheten. M√§rk att detta specialkommando inneh√•ller en 
framk√∂rning till mitten av korsningen, till skillnad fr√•n 90\degree sv√§ngar 
som utf√∂rs omedelbart.

Uppt√§cker korsningen en 90\degree sv√§ng kommer ett annat specialkommando att 
utf√∂ras, d√§r roboten sv√§nger 90\degree √•t det h√•ll som avst√•ndssensorerna 
visar har det l√§ngre avst√•ndet.


\subsubsection{Display}
Robotens display-enhet är av typ \emph{LCD JM162A}. Displayen används för att visa avståndssensorernas värden. Eftersom sensorerna bara kan ge korrekta värden i intervallet 20-120 cm så kommer även displayen arbeta i detta intervall. Displayen arbetar i åtta databitarsläge och visar två rader med tecken. 

%Pinnar
Förutom de åtta databitarna som överförs för varje tecken till displayen så går ytterligare två signaler mellan sensorenhetens mikroprocessor och displayenheten: \emhp{Enable} och \emph{Register select}. Enable-signalen signalerar till displayen att något ska skrivas ut, och Register select väljer mellan input-lägena 'data' och 'function'. Då ingen data läses från displayen så är pinnen \emph{R/W} konstant låg. 

%Kod
Sensorenheten har två funktioner som kan kallas för att skriva ut ett tecken på displayen. I funktionen \emph{char_to_display} anges parmetrarna vilket tecken (givet i ASCII-kod) som ska skrivas ut, samt vilken position på displayen som ska skrivas till. Denna funktion används för bokstäver. För att skriva ut sensorvärden används funktionen \emph{data_to_display}, vilken tar parametrarna för sensorvärdet i cm samt vilken sensor som skickat det. 

Sensorprocessorn har också en funktion för att konvertera cm-värdet till ASCII-kod. 

\subsection{Mjukvara}

\subsubsection{AD}

\subsubsection{Linjesensor}


\subsubsection{Avst√•ndsber√§kning}


\subsubsection{Kommunikation}

